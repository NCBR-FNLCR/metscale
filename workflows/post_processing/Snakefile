'''
Author: Phillip Brooks, Charles Reid
Affiliation: UC Davis Lab for Data Intensive Biology

Date: 2019-04-01
Documentation: docs/workflow_comparison.md
'''

from common.utils  import container_image_is_external, container_image_name
from os.path import join, isfile, dirname
import os, re, glob
from snakemake.remote.HTTP import RemoteProvider as HTTPRemoteProvider
HTTP = HTTPRemoteProvider()




##################################################
# Post processing rules

data_dir = config['data_dir']
biocontainers = config['biocontainers']
taxclass = config['taxonomic_classification']
assembly = config['assembly']
readfilt = config['read_filtering']
comparison = config['comparison']
post_processing = config['post_processing']


##################################################
# Post processing build rules

# Skip to the very end of the file 
# to see the high-level build rules
# that trigger cascades of workflow
# tasks.


##################################################


output_dir_pattern = post_processing['move_samples_to_dir']['output_pattern']
out_dir_sample = workflows['read_filtering_khmer_subsample_interleaved_reads_workflow']['sample']
output_dir = expand(output_dir_pattern, sample=out_dir_sample)[0]
output_dir = join(data_dir, output_dir)

input_string_pattern = "data/" + str(out_dir_sample[0])+"*"
input_files = glob.glob(input_string_pattern)


rule move_samples_to_dir_workflow:
    '''
    move files to seperate dir after processing
    '''
    output:
        directory(output_dir)
    params:
        input_f = input_files,
        output_dir = output_dir
    message: 
        '--- Moving files to samples dir'
    shell:
        "post_processing/move_completed_files.sh {params.output_dir} {params.input_f}"



